Keypad Preview Logic (Current)
Date: 2026-02-12

Scope
- SVG alignment pipeline is the source of truth.
- Slot center math, coordinate mode behavior, and glow geometry are unchanged.

Core Slot Math
1) Slot metrics:
   - sizePx = (sizePct / 100) * baseW
   - cx/cy from leftPct/topPct
   - top-left mode correction:
     - cx += sizePx / 2
     - cy += sizePx / 2
2) Centered icon placement:
   - iconX = cx - iconSize / 2
   - iconY = cy - iconSize / 2

Why icons looked small before
- Matte PNGs contain inconsistent transparent padding.
- Some assets have visible artwork that occupies much less than full image bounds.
- Fixed iconScale therefore produced different apparent sizes by icon.

Icon Fill Fix
1) Runtime visible-area analysis per matte asset URL:
   - Load image
   - Draw to canvas
   - Read alpha bounds
   - visibleRatio = max(visibleWidth / imageWidth, visibleHeight / imageHeight)
2) Normalized scale:
   - effectiveIconScale = min(MAX_EFFECTIVE_ICON_SCALE, iconScale / visibleRatio)
   - MAX_EFFECTIVE_ICON_SCALE = 1.26
3) Default target:
   - DEFAULT_ICON_SCALE = 0.94
4) Clip pocket fit:
   - clipRadius = sizePx * 0.47
   - ringRadius = sizePx * 0.48 (unchanged)

Query Overrides
- ?iconScale=0.85 overrides global target icon scale.
- ?debugSlots=1 shows slot center dots + outer slot circles.
- ?rotationDeg=<number> sets initial preview rotation.
- ?showGlows=0 hides glow rings visually without clearing slot colors.

Preview Interaction
- No Slot 1/2/3/4 labels rendered on the keypad image.
- Empty slot hover shows glass-style prompt text:
  - "Choose a button insert"
- Prompt arrow direction:
  - Top row: arrow points down
  - Bottom row: arrow points up
- Hover never auto-opens popup.
- Clicking slot opens popup.

Popup Search Behavior
- Search input in icon popup (icons tab).
- Fuzzy search fields:
  - icon name
  - icon ID
  - SKU
  - category text
- When a search query is present, search runs across all categories.
- When query is empty, selected category filter is applied.

Sidebar/Panel Updates
- Slot cards show:
  - icon name first
  - icon ID underneath
  - glow line underneath
- Configuration JSON block removed from sidebar.
- Preview info text includes:
  - intro on selecting inserts + glow
  - product description text from store data (plain text).

What was intentionally not changed
- slot.sizePct values
- cx/cy alignment logic
- glow ring radius and blur math
- modal open/close core logic
